<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        html {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .vh-100 {
            min-height: 100vh;
        }

        #drawPad {
            border-color: black;
            border-width: 1px;
            border-style: solid;
        }
    </style>
</head>

<body>
    <div x-data="guestbook">
        <div class="container-xl vh-100" id="screen1">
            <div class="row h-100 justify-content-center text-center align-items-center">
                <div class="col">
                    <img src="assets/rs-text.svg" width="60%" />
                </div>
            </div>
        </div>
        <div class="container-xl vh-100" id="screen2">
            <div class="row justify-content-center text-center align-items-center">
                <div class="col">
                    <canvas id="drawPad" width="800px" height="600px"></canvas>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button type="button" class="btn btn-primary" x-on:click="undo()">Undo</button>
                    <button type="button" class="btn btn-primary" x-on:click="submit()">Submit</button>
                </div>
            </div>
        </div>
        <div id="debug">
            <div id="constructor"></div>
            <div id="json"></div>
            <div id="pressure"></div>
            <div id="type"></div>
        </div>
    </div>
</body>

<script>
    let arg;
    const canvas = document.querySelector("#drawPad");
    const signaturePad = new SignaturePad(canvas, {
        minWidth: 2,
        maxWidth: 2,
        throttle: 0,
    });

    signaturePad.addEventListener("beginStroke", (args) => {
        arg = args;
        document.querySelector("#constructor").innerHTML = args.detail.constructor;
        document.querySelector("#pressure").innerHTML = args.detail.pressure ?? args.detail.force;
        document.querySelector("#type").innerHTML = args.detail.pointerType ?? args.detail.touchType;
    });

    document.addEventListener('alpine:init', () => {
        Alpine.data('guestbook', () => ({
            svgContent: null,
            async submit() {
                const data = signaturePad.toDataURL("image/svg+xml");
                console.log(data);
            },
            async undo() {
                var data = signaturePad.toData();
                if (data) {
                    data.pop(); // remove the last dot or line
                    signaturePad.fromData(data);
                }
            }
        }))
    })

</script>

</html>